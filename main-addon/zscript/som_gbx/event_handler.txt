// Most systems will inherit from this
Class som_gbx_object_base : Object play {}

Class som_gbx_eventhandler : EventHandler
{
	som_gbx_global_data g;
	
	void save_globals()
	{
		Let gc = som_gbx_global_container.Get();
		
		gc.g = g;
	}
	
	void load_globals()
	{
		Let gc = som_gbx_global_container.Get();
		
		g = gc.g;
	}
	
	// Event Overrides
	override void OnRegister()
	{
		// Nada
	}
	
	override void WorldTick()
	{
		g.bxp.check_completion();
		g.bxp.process_timers();
		
		g.gbug_man.check_maxxp_reset();
	}
	
	override void WorldLoaded(WorldEvent e)
	{
		load_globals();
		
		g.master.map_start();
		g.gbug_man.init();
	}
	
	override void WorldUnloaded(WorldEvent e)
	{
		save_globals();
	}
	
	override void RenderOverlay(RenderEvent e)
	{
		g.hud.render();
	}
	
    override void NetworkProcess(ConsoleEvent e)
    {
		// Debug
		if (e.Name ~== "som-gbx-test")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats && players[e.Player].readyweapon) 
			{
				//g.gbug_man.weapon_respec(stats, stats.GetInfoFor(players[e.Player].readyweapon));
				// g.gbug_man.weapon_respec_all(stats);
				// g.gbug_man.player_respec(stats);
				//g.gbug_man.respec_full(stats);
				g.respec.full(stats);
			}
		}

		if (e.Name ~== "som-gbx-test2")
		{
			g.gbug_man.reset_base_xp_cost();

			return;
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats && players[e.Player].readyweapon) 
			{
				//g.gbug_man.weapon_respec(stats, stats.GetInfoFor(players[e.Player].readyweapon));
				// g.gbug_man.weapon_respec_all(stats);
				// g.gbug_man.player_respec(stats);
				//g.gbug_man.respec_full(stats);
				//g.gbug_man.weapons_reset_max_xp(stats);
			}
		}
		
		// Systems
		// Respec
		if (e.Name ~== "som-gbx-respec-weap-curr")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats && players[e.Player].readyweapon) 
			{
				g.respec.weapon_single(stats, stats.GetInfoFor(players[e.Player].readyweapon));
			}
		}

		if (e.Name ~== "som-gbx-respec-weap-all")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats) 
			{
				g.respec.weapon_all(stats);
			}
		}

		if (e.Name ~== "som-gbx-respec-player")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats) 
			{
				g.respec.player(stats);
			}
		}

		if (e.Name ~== "som-gbx-respec-full")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats) 
			{
				g.respec.full(stats);
			}
		}
		
		if (e.Name ~== "som-gbx-respec-reset")
		{
			Let stats = TFLV_PerPlayerStats.GetStatsFor(players[e.Player].mo);

			if (stats) 
			{
				g.respec.reset(stats);
			}
		}
	}
}
